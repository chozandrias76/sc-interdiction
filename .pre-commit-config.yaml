repos:
  - repo: https://github.com/compilerla/conventional-pre-commit
    rev: v3.6.0
    hooks:
      - id: conventional-pre-commit
        stages: [commit-msg]
        args: []

  - repo: https://github.com/adrienverge/yamllint
    rev: v1.35.1
    hooks:
      - id: yamllint
        files: \.(yaml|yml)$

  - repo: local
    hooks:
      # Pre-commit hooks (run on changed rust files)
      - id: cargo-fmt
        name: cargo fmt
        entry: cargo fmt --all --
        language: system
        types: [rust]
        pass_filenames: false

      - id: cargo-clippy
        name: cargo clippy
        entry: cargo clippy --all-targets --all-features
        language: system
        types: [rust]
        pass_filenames: false

      - id: cargo-check
        name: cargo check
        entry: cargo check --all-targets --all-features
        language: system
        types: [rust]
        pass_filenames: false

      - id: cargo-test
        name: cargo test
        entry: cargo test --all-features
        language: system
        types: [rust]
        pass_filenames: false

      - id: cargo-audit
        name: cargo audit
        entry: cargo audit
        language: system
        types: [rust]
        pass_filenames: false

      # Pre-push hooks (always run on push regardless of file changes)
      - id: cargo-fmt-push
        name: cargo fmt (pre-push)
        entry: cargo fmt --all -- --check
        language: system
        stages: [pre-push]
        always_run: true
        pass_filenames: false

      - id: cargo-clippy-push
        name: cargo clippy (pre-push)
        entry: cargo clippy --all-targets --all-features
        language: system
        stages: [pre-push]
        always_run: true
        pass_filenames: false

      - id: cargo-check-push
        name: cargo check (pre-push)
        entry: cargo check --all-targets --all-features
        language: system
        stages: [pre-push]
        always_run: true
        pass_filenames: false

      - id: cargo-test-push
        name: cargo test (pre-push)
        entry: cargo test --all-features
        language: system
        stages: [pre-push]
        always_run: true
        pass_filenames: false

      - id: cargo-audit-push
        name: cargo audit (pre-push)
        entry: cargo audit
        language: system
        stages: [pre-push]
        always_run: true
        pass_filenames: false

      - id: cargo-coverage
        name: cargo coverage (80% minimum)
        entry: cargo tarpaulin --all-features --workspace --timeout 120 --fail-under 80 --skip-clean
        language: system
        stages: [pre-push]
        always_run: true
        pass_filenames: false

      - id: branch-protection
        name: branch protection
        entry: .githooks/check-branch-push.sh
        language: script
        stages: [pre-push]
        always_run: true
        pass_filenames: false
