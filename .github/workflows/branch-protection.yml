name: Branch Protection

on:
  pull_request:
    branches:
      - main

jobs:
  validate-source-branch:
    name: Validate PR Source Branch
    runs-on: self-hosted
    steps:
      - name: Check if PR is from release branch
        run: |
          if [[ ! "${{ github.head_ref }}" =~ ^release/[0-9]+\.[0-9]+\.[0-9]+$ ]]; then
            echo "Error: Pull requests to main must originate from a release/ branch with semantic versioning."
            echo "Current source branch: ${{ github.head_ref }}"
            echo "Expected format: release/X.Y.Z (e.g., release/1.2.3)"
            exit 1
          fi
          echo "Success: PR is from valid release branch: ${{ github.head_ref }}"
